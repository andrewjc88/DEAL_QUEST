function initMap(){var e=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];map=new google.maps.Map(document.getElementById("map"),{center:initLoc,zoom:10,styles:e,mapTypeControl:!1});var t=new ViewModel;t.query.subscribe(t.liveSearch),ko.applyBindings(t)}$(document).foundation();var self=this,markers=[],polygon=null,map,initLoc={lat:37.7749,lng:-122.4194},ViewModel=function(){var e=this,t=new google.maps.InfoWindow;this.zipInput=ko.observable(""),this.gDeals=ko.observableArray([]),this.query=ko.observable(""),this.filteredDeals=ko.observableArray([]),e.newLoc=function(){var t=this.zipInput(),o=new google.maps.Geocoder,l=t;""===l?window.alert("You must enter an zip code to start your Deal Quest!"):o.geocode({address:l},function(t,o){if(o==google.maps.GeocoderStatus.OK){var l={lat:t[0].geometry.location.lat(),lng:t[0].geometry.location.lng()};map.setCenter(t[0].geometry.location),map.setZoom(10),e.getGDeals(l)}else window.alert("We could not find that location - try entering a more specifif place.")})},e.getGDeals=function(t){var o=t;e.gDeals.removeAll(),$.ajax({url:"https://partner-api.groupon.com/deals.json?tsToken=IE_AFF_0_200012_212556_0&filters=category:food-and-drink&limit=30&offset=0&lat="+o.lat+"&lng="+o.lng,dataType:"jsonp",success:function(t){for(var o=t.deals.length,l=0;l<o;l++){var a=t.deals[l].options[0].redemptionLocations[0];if(void 0!==t.deals[l].options[0].redemptionLocations[0]){var r=t.deals[l].merchant.name,s=a.lat,n=a.lng,i=t.deals[l].dealUrl,p=t.deals[l].mediumImageUrl,m=t.deals[l].pitchHtml,c=a.streetAddress1,y=a.city,d=a.state,g=a.postalCode,f=t.deals[l].announcementTitle,u=t.deals[l].tags;e.gDeals.push({name:r,lat:s,lng:n,url:i,img:p,about:m,address:c+"br"+y+", "+d+" "+g,shortAbout:f,tags:u,show:!0})}}e.makeMarkers(e.gDeals())}})},e.makeMarkers=function(t){for(var o={url:"dist/img/gIcon_2.png",scaledSize:new google.maps.Size(40,40)},l=0;l<markers.length;l++)markers[l].setMap(null);for(e.filteredDeals.removeAll(),l=0;l<t.length;l++)if(!0===t[l].show){var a=new google.maps.Marker({position:{lat:t[l].lat,lng:t[l].lng},map:map,icon:o,animation:google.maps.Animation.DROP,title:t[l].name,content:t[l]});markers.push(a),e.filteredDeals.push(a),e.listener(a)}},e.listener=function(t){t.addListener("click",function(){e.populateInfoWindow(this)})},e.populateInfoWindow=function(e){var o='<div id="largeInfowindow"><img src="'+e.content.img+'"><h4>'+e.content.shortAbout+"</h4><p>"+e.content.address+'</p><p><a href="'+e.content.url+'" target="_blank">View deal</a></p><p>'+e.content.about+"</p></div>";t.marker!=e&&(t.marker=e,t.setContent(o),t.open(map,e),t.addListener("closeclick",function(){t.marker=null}))},e.liveSearch=function(t){for(var o=e.gDeals(),l=0;l<o.length;l++)o[l].show=!1,o[l].name.toLowerCase().indexOf(t.toLowerCase())>=0&&(o[l].show=!0),e.makeMarkers(o)},e.getGDeals(initLoc)};