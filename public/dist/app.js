function ViewModel(){function e(e){var o=e;$.ajax({url:"https://partner-api.groupon.com/deals.json?tsToken=IE_AFF_0_200012_212556_0&filters=category:food-and-drink&limit=30&offset=0&lat="+o.lat+"&lng="+o.lng,dataType:"jsonp",success:function(e){for(var o=e.deals.length,l=0;l<o;l++){var r=e.deals[l].options[0].redemptionLocations[0];if(void 0!==e.deals[l].options[0].redemptionLocations[0]){var s=e.deals[l].merchant.name;lat=r.lat,lng=r.lng,url=e.deals[l].dealUrl,img=e.deals[l].mediumImageUrl,about=e.deals[l].pitchHtml,address=r.streetAddress1,city=r.city,state=r.state,zip=r.postalCode,shortAbout=e.deals[l].announcementTitle,tags=e.deals[l].tags,a.gDeals.push({name:s,lat:lat,lng:lng,url:url,img:img,about:about,address:address+"br"+city+", "+state+" "+zip,shortAbout:shortAbout,tags:tags})}}t(a.gDeals())}})}function t(e){var t=new google.maps.InfoWindow,a=e.length;for(i=0;i<a;i++){var s=new google.maps.Marker({position:{lat:e[i].lat,lng:e[i].lng},map:l,icon:n,animation:google.maps.Animation.DROP,title:e[i].name,content:e[i]});r.push(s),s.addListener("click",function(){o(this,t)})}}function o(e,t){var o='<div id="infowindow"><img src="'+e.content.img+'"><h4>'+e.content.shortAbout+"</h4><p>"+e.content.address+'</p><p><a href="'+e.content.url+'" target="_blank">View deal</a></p><p>'+e.content.about+"</p></div>";t.marker!=e&&(t.marker=e,t.setContent(o),t.open(l,e),t.addListener("closeclick",function(){t.marker=null}))}this.zipInput=ko.observable(""),this.gDeals=ko.observableArray([]);var l,a=this,r=[],s={lat:37.7749,lng:-122.4194},n={url:"/dist/img/gIcon_2.png",scaledSize:new google.maps.Size(40,40)};this.newLoc=function(){var t=this.zipInput(),o=new google.maps.Geocoder,a=t;""==a?window.alert("You must enter an zip code to start your Deal Quest!"):o.geocode({address:a},function(t,o){if(o==google.maps.GeocoderStatus.OK){var a={lat:t[0].geometry.location.lat(),lng:t[0].geometry.location.lng()};l.setCenter(t[0].geometry.location),l.setZoom(13),e(a)}else window.alert("We could not find that location - try entering a more specifif place.")})},(new google.maps.drawing.DrawingManager).setMap(l),function(){var t=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];l=new google.maps.Map(document.getElementById("map"),{center:s,zoom:13,styles:t,mapTypeControl:!1}),e(s)}()}$(document).foundation(),ko.applyBindings(new ViewModel);